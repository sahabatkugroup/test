<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sahabatku Delivery - Login</title>
<style>
  body {
    font-family: 'Inter', Arial, sans-serif;
    background-color: #0BA6DF;
    color: #0b3b5a;
    margin: 0; padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
  }
  .container {
    background: #fff;
    border-radius: 20px;
    padding: 24px 28px;
    max-width: 400px;
    width: 90vw;
    box-shadow: 0 12px 30px rgba(74,144,226,0.15);
  }
  h1, h2 {
    text-align: center;
    color: #4a90e2;
    margin-bottom: 24px;
  }
  .btn-group {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  button {
    background-color: #4a90e2;
    color: white;
    border: none;
    border-radius: 14px;
    padding: 16px;
    font-size: 1.1rem;
    font-weight: 700;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  button.secondary {
    background-color: #f5f7fa;
    color: #0b3b5a;
    border: 2px solid #4a90e2;
  }
  button:hover {
    background-color: #3a6fc1;
  }
  button.secondary:hover {
    background-color: #e1e9f8;
  }
  form {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  label {
    font-weight: 600;
    font-size: 1rem;
    color: #506273;
  }
  input[type="text"], input[type="password"], input[type="email"] {
    padding: 14px 16px;
    border-radius: 14px;
    border: 1.5px solid #c9dbf8;
    font-size: 1rem;
    outline: none;
    transition: border-color 0.3s ease;
  }
  input[type="text"]:focus, input[type="password"]:focus, input[type="email"]:focus {
    border-color: #4a90e2;
    box-shadow: 0 0 8px #4a90e2;
  }
  .notification {
    margin-top: 12px;
    font-size: 0.9rem;
    color: #dc3545;
    text-align: center;
  }
  .back-btn {
    margin-top: 8px;
    background-color: #f5f7fa;
    color: #0b3b5a;
    border: 2px solid #4a90e2;
  }
</style>
</head>
<body>
<div class="container" id="initialLoginChoice">
  <h1>Selamat Datang di Sahabatku Delivery</h1>
  <p style="text-align:center; color:#506273; margin-bottom: 32px;">Pilih jenis login Anda:</p>
  <div class="btn-group">
    <button id="showKurirLogin">Login Kurir</button>
    <button id="showAdminLogin" class="secondary">Login Admin</button>
  </div>
</div>

<div class="container hidden" id="kurirLoginForm">
  <h2>Login Kurir</h2>
  <form id="kurirForm">
    <label for="kurirLoginUser ">Username</label>
    <input id="kurirLoginUser " type="text" placeholder="Nama kurir" autocomplete="username" required />
    <label for="kurirLoginPass">Password</label>
    <input id="kurirLoginPass" type="password" placeholder="ID Card" autocomplete="current-password" required />
    <button type="submit">Masuk</button>
  </form>
  <button id="backToInitialKurir" class="back-btn">Kembali</button>
  <p class="notification" id="kurirLoginMsg"></p>
</div>

<div class="container hidden" id="adminLoginForm">
  <h2>Login Admin</h2>
  <form id="adminForm">
    <label for="adminLoginEmail">Email</label>
    <input id="adminLoginEmail" type="email" placeholder="admin@email.com" required />
    <label for="adminLoginPass">Password</label>
    <input id="adminLoginPass" type="password" placeholder="••••••••" required />
    <button type="submit">Masuk</button>
  </form>
  <button id="backToInitialAdmin" class="back-btn">Kembali</button>
  <p class="notification" id="adminLoginMsg"></p>
</div>

<script>
  // Simple show/hide helper
  function showSection(id) {
    document.querySelectorAll('.container').forEach(c => c.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
  }

  document.getElementById('showKurirLogin').onclick = () => showSection('kurirLoginForm');
  document.getElementById('showAdminLogin').onclick = () => showSection('adminLoginForm');
  document.getElementById('backToInitialKurir').onclick = () => showSection('initialLoginChoice');
  document.getElementById('backToInitialAdmin').onclick = () => showSection('initialLoginChoice');

<!-- Pop Notifikasi -->
<div id="notificationPopup" class="notification-popup"></div>
<audio id="notificationSound" src="https://www.soundjay.com/buttons/button-3.mp3" preload="auto"></audio>

<script type="module">
  // Import Firebase SDKs
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-analytics.js";
  import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";
  import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";

  // Firebase config Anda
  const firebaseConfig = {
    apiKey: "AIzaSyCtva8TeL40-WotK4kFL_vL8uUXL3GDfww",
    authDomain: "sahabatkuu-bisa.firebaseapp.com",
    databaseURL: "https://sahabatkuu-bisa-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "sahabatkuu-bisa",
    storageBucket: "sahabatkuu-bisa.firebasestorage.app",
    messagingSenderId: "315555564115",
    appId: "1:315555564115:web:56f46dbceb8c154589d4a6",
    measurementId: "G-PFGYL96VPS"
  };

  // Inisialisasi Firebase Apps
  const app = initializeApp(firebaseConfig, "mainApp"); 
  const db = getDatabase(app); // Realtime Database
  const auth = getAuth(app); // Authentication

  try { getAnalytics(app); } catch(e) {} // Optional analytics

  // UID Admin
  const ADMIN_UID = "kSW4ThusrwhUFCQeTsnPV1VNaR72"; 

  // ====================================================================
  // Helper Functions (UI & Notifikasi)
  // ====================================================================
  const el = (id) => document.getElementById(id);
  const qs = (sel) => document.querySelector(sel);
  const qsa = (sel) => Array.from(document.querySelectorAll(sel));

  function showNotification(message, type = 'success') {
    const popup = el('notificationPopup');
    popup.textContent = message;
    popup.className = `notification-popup show ${type}`;
    el('notificationSound').play();
    setTimeout(() => {
      popup.classList.remove('show');
    }, 3000);
  }

  function showSection(id) {
    qsa('.container > div').forEach(div => div.classList.add('hidden'));
    el(id).classList.remove('hidden');
  }

  // ====================================================================
  // Initial Login Choice
  // ====================================================================
  el('showKurirLogin').addEventListener('click', () => showSection('kurirLoginForm'));
  el('showAdminLogin').addEventListener('click', () => showSection('adminLoginForm'));

  // ====================================================================
  // Kurir Login
  // ====================================================================
  el('kurirLoginBtn').addEventListener('click', doKurirLogin);
  el('backToInitialKurir').addEventListener('click', () => showSection('initialLoginChoice'));

  async function doKurirLogin() {
    const u = el('kurirLoginUser').value.trim();
    const p = el('kurirLoginPass').value.trim();
    const msgEl = el('kurirLoginMsg');
    msgEl.innerText = '';

    try {
      const snap = await get(ref(db, 'kurir/' + u));
      if (snap.exists()) {
        const data = snap.val();
        if (!data.enabled) {
          msgEl.innerText = 'Akun ini dinonaktifkan! Silakan hubungi admin.';
          showNotification('Akun diblokir!', 'error');
          return;
        }
        if (data.password !== p) {
          msgEl.innerText = 'Password salah!';
          showNotification('Password salah!', 'error');
          return;
        }
        localStorage.setItem('currentUser', data.username);
        window.location.href = 'kurir.html'; // Redirect to kurir dashboard
      } else {
        msgEl.innerText = 'User tidak ditemukan!';
        showNotification('User tidak ditemukan!', 'error');
      }
    } catch (err) {
      console.error("Firebase error:", err);
      msgEl.innerText = 'Gagal konek Firebase atau user tidak ditemukan!';
      showNotification('Login gagal!', 'error');
    }
  }

  // Auto-login kurir if already in localStorage
  window.addEventListener('load', () => {
    const savedUser = localStorage.getItem('currentUser');
    if (savedUser) {
      el('kurirLoginUser').value = savedUser;
      // Optionally, attempt to auto-login or just show the form with pre-filled username
      // For security, it's better to require password re-entry or use Firebase Auth for persistent sessions.
      // For this example, we'll just pre-fill.
    }
  });

  // ====================================================================
  // Admin Login
  // ====================================================================
  el('adminLoginBtn').addEventListener('click', doAdminLogin);
  el('backToInitialAdmin').addEventListener('click', () => showSection('initialLoginChoice'));

  async function doAdminLogin() {
    const email = el('adminLoginEmail').value.trim();
    const password = el('adminLoginPass').value.trim();
    const msgEl = el('adminLoginMsg');
    msgEl.innerText = '';

    try {
      const userCredential = await signInWithEmailAndPassword(auth, email, password); 
      if (userCredential.user.uid === ADMIN_UID) {
        localStorage.setItem('isAdminLoggedIn', 'true'); // Simple flag for admin session
        window.location.href = 'admin.html'; // Redirect to admin dashboard
      } else {
        msgEl.innerText = 'Anda bukan admin yang berwenang.';
        showNotification('Login gagal!', 'error');
      }
    } catch (error) {
      console.error("Admin login error:", error);
      msgEl.innerText = 'Login gagal: ' + error.message;
      showNotification('Login Admin Gagal!', 'error');
    }
  }

  // Check admin auth state on load
  onAuthStateChanged(auth, (user) => {
    if (user && user.uid === ADMIN_UID) {
      // If admin is already logged in via Firebase Auth, redirect directly
      window.location.href = 'admin.html';
    } else {
      // If not admin, or no user, show initial choice
      showSection('initialLoginChoice');
    }
  });
</script>
</body>
</html>
