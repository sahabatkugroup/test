<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Sahabatku Delivery - Dashboard Kurir</title>
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <!-- Kurir Dashboard -->
    <div id="kurirDashboard">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
          <div><h2>Halo, <span id="curUser"></span></h2><div class="small">Buat nota ‚Ä¢ Simpan Nota ‚Ä¢ Rekap bulanan ‚Ä¢ Pelacak ‚Ä¢ Cek Ongkir</div></div>
          <div><div class="small">No Nota berikutnya:</div><div id="nextNota" style="font-weight:800;font-size:18px;color:#0b4870">-</div></div>
          <button id="kurirLogoutBtn" class="btn danger">Logout</button>
        </div>
      </div>

      <nav class="tab" id="kurirNavTabs">
        <button data-tab="notaTab" class="active">üìù Nota</button>
        <button data-tab="riwayatTab">üìë Riwayat</button>
        <button data-tab="rekapTab">üìä Rekap</button>
        <button data-tab="pelacakTab">üìã Pelacak</button>
        <button data-tab="cekOngkirModule">üìç Cek Ongkir</button>
        <button data-tab="absensiKurirModule">‚úÖ Absensi Kurir</button>
      </nav>

      <!-- Tab Contents Kurir -->
      <div id="notaTab" class="tabContent">
        <div class="card">
          <h3>Buat / Edit Nota</h3>
          <div class="grid grid-3">
            <div><label>Nama Kurir</label><input id="kurirName" type="text" readonly></div>
            <div><label>Nomor WhatsApp Customer</label><input id="custPhone" type="text" placeholder="6281234... (opsional)"></div>
            <div><label>Ongkir (Rp)</label><input id="ongkir" type="number" value="0" min="0"></div>
          </div>
          <div class="section-title" style="margin-top:14px"><div class="small" style="font-weight:700">Daftar Item</div><div class="btnbar"><button id="btnAddItem" class="btn">+ Item</button><button id="btnClearItems" class="btn secondary">Bersihkan</button></div></div>
          <div id="itemsArea" class="list-v" style="margin-top:10px"></div>
          <div class="section-title" style="margin-top:14px"><div class="small" style="font-weight:700">Tambahan Biaya</div><div class="btnbar"><button id="btnAddTambahan" class="btn secondary">+ Tambahan</button></div></div>
          <div id="tambahanArea" class="list-v" style="margin-top:10px"></div>
          <div class="grid grid-3" style="margin-top:8px;align-items:end">
            <div><label>Total</label><div id="totalPesanan" style="font-weight:800;font-size:22px;color:#0b4870">Rp 0</div><div class="small">Subtotal item + ongkir + tambahan</div></div>
            <div></div>
            <div class="btnbar" style="justify-content:flex-end">
              <button id="btnClearAll" class="btn danger">Bersihkan Semua</button>
              <button id="btnSaveForm" class="btn">Simpan Nota</button>
              <button id="btnExportPreview" class="btn secondary">Simpan Foto</button>
              <button id="btnSharePreview" class="btn secondary">Bagikan WhatsApp</button>
            </div>
          </div>
          <div class="card" style="margin-top:12px">
            <div class="section-title"><h3 style="margin:0">Preview Nota</h3><div class="small">Nama file: <span id="previewFilename">-</span></div></div>
            <div id="notaPreview" class="nota-box">Belum ada nota.</div>
          </div>
        </div>
      </div>

      <div id="riwayatTab" class="tabContent hidden">
        <div class="card">
          <h3>Riwayat Nota (akun ini)</h3>
          <div id="notaHistory"></div>
        </div>
      </div>

      <div id="rekapTab" class="tabContent hidden">
        <div class="card">
          <h3>Rekap Bulanan</h3>
          <div class="grid grid-3">
            <div><label>Bulan</label><input id="rekapMonth" type="month"></div>
            <div style="align-self:end"><button id="btnLoadRekap" class="btn">Muat Rekap</button></div>
          </div>
          <div class="card" style="margin-top:10px">
            <table aria-label="Rekap Bulanan">
              <thead><tr><th>Tanggal</th><th>Jumlah Nota</th><th>Ongkir</th><th>Tambahan</th><th>Total</th></tr></thead>
              <tbody id="rekapBody"></tbody>
              <tfoot><tr><th>Total Bulan</th><th id="sumNota">0</th><th id="sumOngkir">0</th><th id="sumTambahan">0</th><th id="sumTotal">0</th></tr></tfoot>
            </table>
          </div>
        </div>
      </div>

      <div id="pelacakTab" class="tabContent hidden">
        <div class="card">
          <h3>Pelacak Orderan</h3>
          <div class="grid grid-3">
            <div><label>No Nota</label><input id="trackNoNota" type="text" placeholder="cth: 00012" list="listTrackNoNota">
              <datalist id="listTrackNoNota"></datalist>
            </div>
            <div><label>Tanggal (YYYY-MM-DD)</label><input id="trackDate" type="date" placeholder="2025-09-01"></div>
            <div><label>Nama Kurir</label><input id="trackKurir" type="text" placeholder="Nama Kurir" list="listTrackKurir">
              <datalist id="listTrackKurir"></datalist>
            </div>
            <div style="align-self:end; grid-column: span 3;"><div class="btnbar"><button id="btnCariNota" class="btn">Cari</button><button id="btnCariReset" class="btn secondary">Reset</button></div></div>
          </div>
          <div id="pelacakHasil" style="margin-top:10px"></div>
        </div>
      </div>

      <div id="cekOngkirModule" class="tabContent hidden cek-ongkir-module">
        <div class="hero">
          <div class="brand"><i class="fa-solid fa-box"></i> Ongkir Express</div>
          <div class="headline">Cek Tarif Pengiriman ‚Äì Asal & Tujuan</div>
          <div class="sub">Pilih lokasi lewat pencarian pintar. Bisa isi salah satu atau keduanya. Otomatis hitung sesuai aturan.</div>
        </div>
        <main class="card">
          <div class="card__body">
            <div class="grid">
              <div class="field" id="field-asal">
                <div class="label"><i class="fa-solid fa-location-arrow"></i> Asal (opsional)</div>
                <div class="control"><i class="fa-solid fa-magnifying-glass licon"></i><input id="asalInput" class="input" type="text" placeholder="Ketik lokasi asal‚Ä¶ (opsional)"/><button class="clear-btn" title="Bersihkan" id="clearAsal"><i class="fa-solid fa-xmark"></i></button><div class="suggest" id="asalSuggest"></div></div>
              </div>
              <div class="field" id="field-tujuan">
                <div class="label"><i class="fa-solid fa-location-dot"></i> Tujuan</div>
                <div class="control"><i class="fa-solid fa-magnifying-glass licon"></i><input id="tujuanInput" class="input" type="text" placeholder="Ketik lokasi tujuan‚Ä¶"/><button class="clear-btn" title="Bersihkan" id="clearTujuan"><i class="fa-solid fa-xmark"></i></button><div class="suggest" id="tujuanSuggest"></div></div>
              </div>
            </div>
            <div class="actions">
              <button id="cekBtn" class="btn btn-primary"><i class="fa-solid fa-calculator"></i> Cek Ongkir</button>
              <button id="bersihkanBtn" class="btn btn-ghost"><i class="fa-solid fa-broom"></i> Bersihkan</button>
            </div>
            <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap">
              <span class="pellet"><i class="fa-regular fa-circle-check"></i> Isi salah satu = ongkir normal</span>
              <span class="pellet"><i class="fa-regular fa-circle-check"></i> Isi dua-duanya = (Asal + Tujuan) ‚àí 6.000</span>
            </div>
            <div class="results" id="ongkirResults" style="display:none">
              <div class="kartu"><h4><i class="fa-solid fa-tag"></i> Ongkir Normal</h4><div class="harga" id="normalHarga">‚Äì</div><div class="muted" id="normalKeterangan">‚Äî</div></div>
              <div class="kartu"><h4><i class="fa-solid fa-route"></i> Ongkir Rute (Asal + Tujuan ‚àí 6.000)</h4><div class="harga" id="ruteHarga">‚Äì</div><div class="muted" id="ruteKeterangan">‚Äî</div><div class="formula" id="ruteFormula" style="display:none"></div></div>
            </div>
          </div>
        </main>
      </div>

      <div id="absensiKurirModule" class="tabContent hidden absensi-module">
        <div class="card">
          <h1>Jadwal & Absensi Kurir</h1>
          <div class="topbar" id="absensiTopbar">
            <button class="btn active" data-tab="tab-jadwal">Jadwal Off</button>
            <button class="btn" data-tab="tab-rekap">Rekap & Keaktifan</button>
            <button class="btn ghost" id="btn-absensi-tab" data-tab="tab-absensi" style="display:none;">Absensi Harian</button>
            <button class="btn ghost" data-tab="tab-approval" id="btn-approval-tab" style="display:none;">Approval Kurir</button>
            <div class="month-wrap">
              <label for="monthPick"><small>Bulan:</small></label>
              <input type="month" id="monthPick"/>
            </div>
          </div>

          <div class="admin-bar" id="absensiAdminBar">
            <button class="btn alt" id="btn-save">Save Data (Firestore)</button>
            <button class="btn alt" id="btn-regen">Regenerasi Off</button>
            <button class="btn" id="btn-add-kurir-absensi">Tambah Kurir</button>
            <button class="btn danger" id="btn-del-kurir-absensi">Hapus Kurir</button>
            <button class="btn secondary" id="btn-block-kurir-absensi">Blokir Kurir</button>
            <button class="btn secondary" id="btn-unblock-kurir-absensi">Buka Blokir Kurir</button>
          </div>

          <!-- Tabs Absensi -->
          <div id="tab-jadwal" class="tab active">
            <div id="pengajuanForm" class="grid grid-3" style="gap: 10px; margin-bottom: 16px; padding: 10px; border: 1px solid var(--border); border-radius: 12px;">
              <div><label>Tanggal Off Anda</label><select id="pengajuanTanggal"></select></div>
              <div><label>Pengganti</label><select id="penggantiKurir"></select></div>
              <div><label>Tanggal Off Pengganti</label><select id="tanggalTukar"></select></div>
              <div style="grid-column: span 3;"><button class="btn full" id="btnAjukan">Ajukan Tukar Off</button></div>
            </div>
            <div class="table-wrap">
              <table id="tableJadwal">
                <thead><tr><th>Tanggal</th><th>Hari</th><th>Kurir Off</th><th>Pengganti</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>

          <div id="tab-absensi" class="tab">
            <div class="table-wrap">
              <table id="tableAbsensi">
                <thead><tr><th>Tanggal</th><th>Nama Kurir</th><th>Status</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>

          <div id="tab-rekap" class="tab">
            <div class="table-wrap">
              <table id="tableRekap">
                <thead><tr><th>Nama Kurir</th><th>Total On</th><th>Total Off</th><th>Skor Keaktifan</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>

          <div id="tab-approval" class="tab">
            <div class="table-wrap">
              <table id="tableApproval">
                <thead><tr><th>Tanggal Pengajuan</th><th>Kurir Asal</th><th>Pengganti</th><th>Status</th><th>Aksi</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pop Notifikasi -->
  <div id="notificationPopup" class="notification-popup"></div>
  <audio id="notificationSound" src="https://www.soundjay.com/buttons/button-2.mp3" preload="auto"></audio>

  <!-- Pop-up Foto Nota -->
  <div id="notaPhotoOverlay" class="overlay">
    <div class="overlay-content">
      <button class="overlay-close" id="closePhotoOverlay">&times;</button>
      <img id="notaPhotoImage" src="" alt="Nota Photo" />
      <div class="btnbar" style="margin-top: 15px; justify-content: center;">
        <button id="savePhotoBtn" class="btn">Simpan Foto</button>
        <button id="shareTextBtn" class="btn secondary">Bagikan Teks WhatsApp</button>
      </div>
    </div>
  </div>

  <script type="module" src="firebase_config.js"></script>
  <script type="module" src="common_script.js"></script>
  <script type="module" src="kurir_script.js"></script>
</body>
</html>
