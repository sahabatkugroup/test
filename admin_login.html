<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Sahabatku Delivery - Login Admin</title>
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <!-- Form Login Admin -->
    <div id="adminLoginForm" class="card">
      <h2>Login Admin</h2>
      <div class="grid grid-3">
        <div><label>Email</label><input id="adminLoginEmail" type="email" placeholder="admin@email.com"></div>
        <div><label>Password</label><input id="adminLoginPass" type="password" placeholder="••••••••"></div>
        <div style="align-self:end"><div class="btnbar"><button id="adminLoginBtn" class="btn full">Masuk</button><button id="backToInitialAdmin" class="btn secondary full">Kembali</button></div></div>
      </div>
      <p id="adminLoginMsg" class="small" style="color:var(--error-color);margin-top:8px"></p>
    </div>
  </div>

  <!-- Notification -->
  <div id="notificationPopup" class="notification-popup"></div>
  <audio id="notificationSound" src="https://www.soundjay.com/buttons/button-2.mp3" preload="auto"></audio>

  <script type="module" src="firebase_config.js"></script>
  <script type="module" src="common_script.js"></script>
  <script type="module">
    import { auth, ADMIN_UID } from './firebase_config.js';
    import { showNotification } from './common_script.js';
    import { signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";

    const el = (id) => document.getElementById(id);

    el('adminLoginBtn').addEventListener('click', doAdminLogin);
    el('backToInitialAdmin').addEventListener('click', () => {
      window.location.href = 'index.html';
    });

    async function doAdminLogin() {
      const email = el('adminLoginEmail').value.trim();
      const password = el('adminLoginPass').value.trim();
      const msgEl = el('adminLoginMsg');
      msgEl.innerText = '';

      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password); 
        if (userCredential.user.uid === ADMIN_UID) {
          showNotification('Login Admin Berhasil!', 'success');
          localStorage.setItem('adminLoggedIn', 'true'); // Store admin login status
          window.location.href = 'admin_dashboard.html';
        } else {
          msgEl.innerText = 'Anda bukan admin yang berwenang.';
          await signOut(auth); 
          showNotification('Login gagal!', 'error');
        }
      } catch (error) {
        console.error("Admin login error:", error);
        msgEl.innerText = 'Login gagal: ' + error.message;
        showNotification('Login Admin Gagal!', 'error');
      }
    }

    // Persistensi login admin (check on page load)
    onAuthStateChanged(auth, (user) => {
      if (user && user.uid === ADMIN_UID && localStorage.getItem('adminLoggedIn') === 'true') {
        // If already logged in as admin, redirect to dashboard
        window.location.href = 'admin_dashboard.html';
      }
    });
  </script>
</body>
</html>
